<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="ja">
<head>
<!-- Generated by javadoc (1.8.0_265) on Mon Sep 21 20:24:13 JST 2020 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>hiMongo</title>
<meta name="date" content="2020-09-21">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<script type="text/javascript" src="../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="hiMongo";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":9,"i3":9,"i4":9,"i5":9,"i6":9,"i7":9,"i8":9,"i9":9,"i10":9,"i11":9,"i12":9,"i13":9,"i14":9,"i15":9,"i16":9,"i17":9};
var tabs = {65535:["t0","すべてのメソッド"],1:["t1","staticメソッド"],8:["t4","concreteメソッド"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>ブラウザのJavaScriptが無効になっています。</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="ナビゲーション・リンクをスキップ">ナビゲーション・リンクをスキップ</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="ナビゲーション">
<li><a href="../hi/package-summary.html">パッケージ</a></li>
<li class="navBarCell1Rev">クラス</li>
<li><a href="package-tree.html">階層ツリー</a></li>
<li><a href="../deprecated-list.html">非推奨</a></li>
<li><a href="../index-all.html">索引</a></li>
<li><a href="../help-doc.html">ヘルプ</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>前のクラス</li>
<li><a href="../hi/hiMongo.Accessor.html" title="hi内のクラス"><span class="typeNameLink">次のクラス</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?hi/hiMongo.html" target="_top">フレーム</a></li>
<li><a href="hiMongo.html" target="_top">フレームなし</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses-noframe.html">すべてのクラス</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>サマリー:&nbsp;</li>
<li><a href="#nested.class.summary">ネスト</a>&nbsp;|&nbsp;</li>
<li>フィールド&nbsp;|&nbsp;</li>
<li>コンストラクタ&nbsp;|&nbsp;</li>
<li><a href="#method.summary">メソッド</a></li>
</ul>
<ul class="subNavList">
<li>詳細:&nbsp;</li>
<li>フィールド&nbsp;|&nbsp;</li>
<li>コンストラクタ&nbsp;|&nbsp;</li>
<li><a href="#method.detail">メソッド</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">hi</div>
<h2 title="クラス hiMongo" class="title">クラス hiMongo</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>hi.hiMongo</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">hiMongo</span>
extends <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a></pre>
<div class="block">mongoDBアクセス機.

<pre class=quote10 style="background-color:black;color:#eeffff">

 // JAVAプログラム
 hiMongo.DB db=hiMongo.use("db01");   // database   選択
 db.get("coll_01")                    // collection 選択
   .find("{type:'A'}","{_id:0}")      // typeが'A'のレコード
   .sort("{_id:-1}")                  // _idで逆向きにソート
   .limit(3)                          // 個数制限
   .getJsonList(hiU.REVERSE)          // 反転したリスト取得
   .forEach(S->System.out.println(S));// レコード表示

</pre>
<p>
hiMongoはドキュメント指向のDataBaseであるmongoDBにアクセスするjavaライブラリです。<br>
hiMongoはmongo-java-driverのラッパーです。
</p>
<ul>
<li><a class=A1 href="#api">JavaでmongoDB;hiMongo-APIの基本</a></li>
<li><a class=A1 href="#find">find(検索)の引数と結果</a>
   <ul>
   <li><a class=A1 href="#class">利用者定義クラス・インスタンスを得る</a>
   <li><a class=A1 href="#probe">汎用データ探索機hiJSON.Probeで受け取る</a>
   </ul>
</li>
<li><a class=A1 href="#insert">insert/update/replace/delete/drop</a>
   <ul>
   <li><a class=A1 href="#insertOne">insert,drop(条件無)</a>
   <li><a class=A1 href="#update">条件付き操作(update,replace,delete)</a>
   <li><a class=A1 href="#cap">キャップ（最大容量)指定</a>
   </ul>
</li>
<li><a class=A1 href="#aggre">aggregate(集計）の引数と結果</a></li>
<li><a class=A1 href="#lookup">aggregate(集計）lookupによるフィールド結合</a></li>
<li><a class=A1 href="#mson">mongoDB拡張JSON(mson)記述</a>
   <ul>
   <li><a class=A1 href="#quote">引用符</a>
   <li><a class=A1 href="#date">ObjectId,Dateと数値</a>
   <!--<li><a class=A1 href="#regex">正規表現</a>-->
   <li><a class=A1 href="#comment">コメント等のhiMongo拡張(hson)</a>
   </ul>
</li>
<li><a class=A1 href="#remote">リモート接続</a></li>
<li><a class=A1 href="#driver">driver-APIを使う</a>
   <ul>
   <li><a class=A1 href="#createIndex">例：createIndex</a>
   </ul>
</li>
<li><a class=A1 href="#node">node(Object,Document)の取り扱い</a></li>
<li><a class=A1 href="#build">ビルド</a></li>
<li><a class=A1 href="#log">ライブラリの出すログ</a></li>
<li><a class=A1 href="#interface">API</a></li>
</ul>
<p>


<table style="line-height:90%" class=t0>
<tr><td colspan=2>用語:</td></tr>
<tr><td>mson</td><td>: mongoDB用の拡張JSON記述;ObjectId(...),ISODate(...)あり</td><tr>
<tr><td>json</td><td>: 標準JSON記述</td><tr>
<tr><td>hson</td><td>: msonにコメント等の入力解析拡張を行ったもの</td><tr>
<tr><td>Database</td><td>: データベース。名前付きcollectionの集合</td><tr>
<tr><td>Collection</td><td>: レコードの集合</td><tr>
<tr><td>レコード</td><td>: 入出力データの基本単位,名前付きフィールドの集合</td><tr>
<tr><td>フィールド</td><td>: レコード内の名前付きの値</td><tr>
<tr><td>ノード</td><td>: プログラム上でのデータ要素。データはノードのツリー構造となる</td><tr>
<tr><td>Document</td><td>: プログラムでのmsonのノード実装クラスおよびノードデータ<br>
mongoDBではレコードの事を'ドキュメント'と呼ぶとされているが、ここではプログラム上で限定される<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a>クラスを指す</td></tr>
<tr><td>bson</td><td>: msonのバイナリ表現(プログラム上およびDB上)<br>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/conversions/Bson.html?is-external=true" title="org.bson.conversions内のクラスまたはインタフェース"><code>Bson</code></a>クラスはJSON式の構造は採っておらず、hiMongoでは対象外としています。
</td><tr>
<tr><td>
hiJSON
</td><td>:hiMongoが使用している
<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース"><code>JSONハンドリング機構</code></a>
；
<a class=A1 target="_blank" rel="noopener noreferrer" href=
"http://www.otsu.co.jp/OtsuLibrary"
><i>Otsu</i>ラリブラリ
</a>
/
<a class=A1 target="_blank" rel="noopener noreferrer" href=
"http://www.otsu.co.jp/OtsuLibrary/jdoc/index.html"
>hiNoteパッケージ
</a>
に属するクラスです。
<td></tr>
</table>
</p>
<p class=B1 id="api">
&emsp;JavaでmongoDB;hiMongo-APIの基本
</p>
<p>
次のプログラムはJava用のmongoDBライブラリhiMongoの使用例です。
</p>
<pre class=quote10>
 // JAVAプログラム
 hiMongo.DB db=hiMongo.use("db01");   // database   選択
 db.get("coll_01")                    // collection 選択
   .find("{type:'A'}","{_id:0}")      // typeが'A'のレコード
   .sort("{_id:-1}")                  // _idで逆向きにソート
   .limit(3)                          // 個数制限
   .getJsonList(hiU.REVERSE)          // 反転したリスト取得
   .forEach(S->System.out.println(S));// レコード表示
</pre>
<p>
mongoDBのCUIであるmongo-shellの次の手続きに相当します。
</p>
<pre class=quote10>
 // mongo shell script
 use db01;
 db.coll_01.                             // collection 選択
    find({type:'A'},{_id:0}).            // typeが'A'のレコード
    sort({_id:-1}).                      // _idで逆向きにソート
    limit(3).                            // 個数制限
    toArray().reverse().                 // 反転したリスト取得
    forEach(S=>print(JSON.stringify(S)));// 要素表示
</pre>
<p>
typeフィールドが'A'であるレコードの最新３個を取得しています。
</p>
<p>
実際にビルド・実行できるフルコードと実行結果を示します
</p>
<div id="divSimple_1">
<p><input type="button" value="フルコードを表示する" style="WIDTH:12em"
   onClick="document.getElementById('divSimple_2').style.display='block';
            document.getElementById('divSimple_1').style.display='none'"></p>
</div>
<div id="divSimple_2" style="display:none">
<p><input type="button" value="フルコードを隠す" style="WIDTH:12em"
   onClick="document.getElementById('divSimple_2').style.display='none';
            document.getElementById('divSimple_1').style.display='block'"></p>
<pre class=quote8>
// このプログラムではtypeフィールドが'A'のレコードの最新３個を表示しています
// sort({_id-1})で一旦並びを逆にしていますので、リストは再反転して取得します
// ここではmongo-shellの出力形式と揃えるためgetMsonListを使っています
import hi.hiMongo;
import otsu.hiNote.*;
public class Test {
   public static void main(String[] args_){
      try(hiMongo.DB db=hiMongo.use("db01")){  // database   'db01'選択
         db.get("coll_01")                     // collection 選択
            .find("{type:'A'}","{_id:0}")      // typeが'A'のレコード,
            .sort("{_id:-1}")                  // _idで逆向きにソート
            .limit(3)                          // 個数制限
            .getMsonList(hiU.REVERSE)          // 反転したリスト取得
            .forEach(S->System.out.println(S)) // レコード表示
            ;
         }
      catch(Exception _ex){
         _ex.printStackTrace(System.err);
         System.exit(1);
         }
      System.exit(0);
      }
   }
＊＊＊＊＊＊　dbデータ
> use db01
switched to db db01
> db.coll_01.find({},{_id:0})
{ "type" : "A", "value" : 12.3, "date" : ISODate("2020-08-17T07:07:00Z") }
{ "type" : "A", "value" : 4.56, "date" : ISODate("2020-08-17T07:07:10Z") }
{ "type" : "B", "value" : 2001, "date" : ISODate("2020-08-17T07:07:20Z") }
{ "type" : "A", "value" : 7.89, "date" : ISODate("2020-08-17T07:07:30Z") }
{ "type" : "A", "value" : 0.12, "date" : ISODate("2020-08-17T07:07:40Z") }
＊＊＊＊＊＊　ビルド実行結果
$ ./run.sh
----- 01simpleAccess -----
{"type":"A", "value":4.56, "date":ISODate("2020-08-17T07:07:10.000Z")}
{"type":"A", "value":7.89, "date":ISODate("2020-08-17T07:07:30.000Z")}
{"type":"A", "value":0.12, "date":ISODate("2020-08-17T07:07:40.000Z")}
OK
</pre>
<p><input type="button" value="フルコードを隠す△" style="WIDTH:12em"
   onClick="document.getElementById('divSimple_2').style.display='none';
            document.getElementById('divSimple_1').style.display='block';
            document.location='#div_1'"></p>
</div>
<p>
条件やレコード内容などの主要パラメタはmson(mongoDBの拡張JSON)で与えます。
</p>
<p>
レコードの挿入では次の様にレコード内容を拡張JSON(mson)で与えます。
</p>
<pre class=quote10>
 // JAVAプログラム
 hiMongo.DB db=hiMongo.use("db01"));  // database   選択
 db.get("coll_01")                    // collection 選択
   .insertOne("{type:'A',value:21,date:{$date:1597648050000}}");
</pre>
<p>
時刻は{$date:<i>Unix-Epoch</i>}またはISODate('<i>グリニッジ日時</i>')の形です。<br>
mongo-shellでは<b>new Date</b>(<i>Unix-Epoch</i>)またはISODate('<i>グリニッジ日時</i>')となります。
</p>
<pre class=quote10>
 // mongo-shell
use db01
db.coll_01.
   insertOne({type:'A',value:21,date:<b>new Date</b>(1597648050000)});
</pre>
</p>

<p>
次のようなAPIが用意されており、冒頭のようなカスケード式で呼び出すことも各型の変数で結果を受けて改めて呼び出すことも出来ます
</p>
<pre class=quote10>
hiMongo#<span class=red>use</span>                    => DB
   DB#<span class=red>get</span>                      => Collection
      Collection#<span class=red>find</span>          => Finder
         Finder#<span class=red>sort</span>           => Finder
         Finder#<span class=red>limit</span>          => Finder
         Finder#<span class=red>skip</span>           => Finder
         Finder#<span class=red>forEachXXX</span>     => Finder
         Finder#<span class=blue>getXXXList</span>     => ArrayList<XXX>
      Collection#<span class=red>aggregate</span>     => Aggregator
         Aggregator#<span class=red>forEachXXX</span> => Aggregator
         Aggregator#<span class=blue>getXXXList</span> => ArrayList<XXX>
      Collection#<span class=red>insertOne</span>     => Collection
      Collection#<span class=red>insertMany</span>    => Collection
      Collection#<span class=red>updateOne</span>     => Collection
      Collection#<span class=red>updateMany</span>    => Collection
      Collection#<span class=red>replaceOne</span>    => Collection
      Collection#<span class=red>deleteOne</span>     => Collection
      Collection#<span class=red>deleteMany</span>    => Collection
</pre>



<p class=B1 id=find>
&emsp;find(検索)の引数と結果
</p>
<p>
findは２つの引数を持ちます。検索条件と取得フィールドです。<br>
</p>
<p class=c>
&emsp;検索条件
</p>
<p>
検索条件には次の様な記述が出来ます。
</p>

<p>
<table class=t>
<tr>
<td>条件</td>
<td>記述例</td>
</tr>
<tr>
<td>無条件</td>
<td>find()またはfind("{}")</td>
</tr>
<tr>
<td>フィールド値の単純一致</td>
<td>find("{name:'A'}")</td>
</tr>
<tr>
<td>フィールド値の大小判断</td>
<td>find("{value:{$gt:100}}")
<pre class=quot8>
形式:
{<i>field</i>:{$eq:<i>値</i>}}        ==
{<i>field</i>:{$ne:<i>値</i>}}        !=
{<i>field</i>:{$lt:<i>値</i>}}        <
{<i>field</i>:{$lte:<i>値</i>}}       <=
{<i>field</i>:{$gt:<i>値</i>}}        >
{<i>field</i>:{$gte:<i>値</i>}}       >=
{<i>field</i>:{$in:[<i>値,..</i>]}}   含まれる
{<i>field</i>:{$nin:[<i>値,...</i>]}} 含まれない
</pre>
</td>
</tr>
<tr>
<td>条件の組み合わせ</td>
<td>find("{$and:[{name:'A'},{value:{$gt:100}}]}")
<pre class=quot8>
形式:
{$and:[{条件},{条件},...]}
{$or:[{条件},{条件},...]}
</pre>

</td>
</tr>
<tr>
<td>部分一致、正規表現</td>
<td>
find("{name:/et/}") nameがetを含む<br> 
find("{name:/^T.*sky$/}") nameがTで始まりskyで終わる<br>
find("{name:/(ba|ab)}") nameがbaまたはabを含む
</td>
</tr>
</table>
</p>


<p class=c>
&emsp;取得フィールド
</p>
<p>
取得フィールドの指定は{}内に「フィールド名：0または１」を必要分カンマで繋いで記述します。<br>
0は非表示（取得しない)を1は表示(取得する)を表します。<br>
指定は_idフィールドとその他の利用者フィールドでは意味が少し異なります。<br>
利用者フィールドに1を指定した場合、指定しないフィールドは非表示となります。0を指定した場合指定フィールドが非表示となります。<br>
利用者フィールドの指定に0と1が混在することは許されません。
</p>
<pre class=quote10>
find()                       // 全て取得
find("{}")                   // 全て取得
find("{}","{}")              // 全て取得
find("{}","{_id:0}")         // _idフィールド以外全て取得
<span class=gray>{ "A" : 10, "B" : 20, "C" : 30, "D" : 40 }
{ "A" : 11, "B" : 21, "C" : 31, "D" : 41 }</span>
find("{}","{_id:0,A:1}")     // Aフィールドのみ取得
<span class=gray>{ "A" : 10 }
{ "A" : 11 }</span>
find({},{_id:0,A:0})         // _id,Aフィールド以外取得
<span class=gray>{ "B" : 20, "C" : 30, "D" : 40 }
{ "B" : 21, "C" : 31, "D" : 41 }</span>
find("{}","{_id:0,A:1,C:1}") // A,Cフィールドのみ取得
<span class=gray>{ "A" : 10, "C" : 30 }
{ "A" : 11, "C" : 31 }</span>
find("{}","{_id:0,A:0,C:0}") // _id,A,Cフィールド取得以外取得
<span class=gray>{ "B" : 20, "D" : 40 }
{ "B" : 21, "D" : 41 }</span>
find("{}","{_id:0,A:0,C:1}") // エラー
</pre>
<p>
取得しないと指定したフィールドでも検索条件、ソート条件に使用できます。
</p>
<p class=c>
&emsp;結果の取得
</p>
<p>
findの戻りは<a href="../hi/hiMongo.Finder.html" title="hi内のクラス"><code>hiMongo.Finder</code></a>で、hiMongo.Finderは<a href="../hi/hiMongo.Finder.html#sort-java.lang.Object-"><code>sort()</code></a>,<a href="../hi/hiMongo.Finder.html#limit-int-"><code>limit()</code></a>など幾つかの手順を経て最終的にはgetXXXList()メソッドで結果をArrayListにして戻します。
</p>
<p>
得られるリストは次のものです。
</p>
<p>
<table class=t>
<tr>
<td>要素の型</td><td>取得メソッド</td><td>説明</td>
</tr>

<tr>
<td><a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a></td><td>getNodeList</td>
<td>
mongoDBの原始的なデータノードです。<br>
基本的にはJSONに対応するObjectのツリーですが、StringやMapなどの基本タイプの他<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/types/ObjectId.html?is-external=true" title="org.bson.types内のクラスまたはインタフェース"><code>ObjectId</code></a>クラス,<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/util/Date.html?is-external=true" title="java.util内のクラスまたはインタフェース"><code>Date</code></a>クラスを持ちます。
toJson()メソッドでJSON文字列を得ることができますが、日本語はutfコードに文字化けすることがあります。<br>
ObjectIdは{"@oid":"....."}、Dateは{"@date":unixエポック}の形で得られます。
</td>
</tr>

<tr>
<td>クラスインスタンス</td><td>getClassList</td>
<td>
利用者クラスにマップしたデータが得られます。<br>
最も間違いが起こりにくい方法です。
</td>
</tr>

<tr>
<td>hiJSON.Probe</td><td>getProbeList</td>
<td>
データノードを探索機です。
</td>
</tr>


<tr>
<td>String(mson)</td><td>getMsonList</td>
<td>
mongoの拡張JSON形の文字列。<br>
ObjectId("..."),ISODate("...")が用いられます。
</td>
</tr>


<tr>
<td>String(json)</td><td>getJsonList</td>
<td>
標準JSON形の文字列。<br>
{"$oid":"..."},{"$date":"..."}が用いられます。
</td>
</tr>

</table>
</p>
<p>
getXxxList()にhiU.REVERSEを付けると逆並びとなります。
<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiU.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース"><code>hiU</code></a>は汎用ライブラリ<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/package-summary.html?is-external=true"><code>otsu.hiNote</code></a>の代表クラスです。
</p>
<p>
hiMongo.Finderが持つforEachXXX()メソッドを用いればリストを構築することなく、各要素毎得ることが出来ます。
</p>


<p class=B2_2 id="class">
&emsp;利用者定義クラス・インスタンスを得る
</p>
<p>
findの結果を利用者定義のクラス・インスタンスのリストとして得ることが出来ます。
</p>
<pre class=quote10>
<span class=red>class Record</span> {   // レコード内容
   String type;
   double value;
   Date   date;
   }
-----
double _start_date=取得開始レコードのunixエポック
ArrayList&lt;<span class=red>Record</span>> _recs
=db.get("coll_01")
   .find("{$and:["+
            "{type:'A'},"+
            "{date:{$gte:{$date:"+_start_date+"}}}"+
            "]}",
         "{_id:0}")
   .<span class=blue>getClassList</span>(<span class=red>Record.class</span>);
<span class=gray>for(Record _rec:_recs){
   System.out.println("value="+_rec.value);
   }</span>
</pre>

<div id="divClass_1">
<p><input type="button" value="フルコードを表示する" style="WIDTH:12em"
   onClick="document.getElementById('divClass_2').style.display='block';
            document.getElementById('divClass_1').style.display='none'"></p>
</div>
<div id="divClass_2" style="display:none">
<p><input type="button" value="フルコードを隠す" style="WIDTH:12em"
   onClick="document.getElementById('divClass_2').style.display='none';
            document.getElementById('divClass_1').style.display='block'"></p>
<pre class=quote8>
// このプログラムでは先ず最後のレコードのdate情報を取得し、それから
// 30秒前からのレコードをRecordクラスの並びとして取得し、統計情報を
// 計算しています。
import hi.hiMongo;
import otsu.hiNote.*;
import java.util.*;
public class Test {
   static class WithDate { // dateだけを得るクラス
      Date date;
      }
   static class Record {   // レコード内容
      String type;
      double value;
      Date   date;
      }
   public static void main(String[] args_){
      try(hiMongo.DB db=hiMongo.use("db01")){
         //----------------------------------------------
         // 最後の'A'レコードの時刻(unix-epoch)を得る
         long _last_date
         =db.get("coll_01")
            .find("{type:'A'}","{_id:0,date:1}")
            .sort("{_id:-1}").limit(1)
            .getClassList(WithDate.class)
            .get(0).date.getTime();
         //----------------------------------------------
         // 最後のレコードの30秒前からの'A'レコード取得
         long _start_date= _last_date-30000; // 30秒前
         System.out.println("last="+_last_date+" start="+_start_date);
         ArrayList&lt;Record> _recs
         =db.get("coll_01")
            .find("{$and:["+
                        "{type:'A'},"+
                         "{date:{$gte:{$date:"+_start_date+"}}}"+
                          "]}",
                  "{_id:0}")
            .getClassList(Record.class);
         System.out.println("records="+hiU.str(_recs,hiU.WITH_INDENT));
         //----------------------------------------------
         // 最大、最少、平均を求める
         double _min  = Double.MAX_VALUE;
         double _max  = Double.MIN_VALUE;
         double _total= 0;
         for(Record _rec:_recs){
            double _val=_rec.value;
            _min    = Math.min(_min,_val);
            _max    = Math.max(_max,_val);
            _total += _val;
            }
         double _avg= _total/_recs.size();
         System.out.printf("min=%.2f max=%.2f avg=%.2f\n",_min,_max,_avg);
         }
      catch(Exception _ex){
         _ex.printStackTrace(System.err);
         System.exit(1);
         }
      System.exit(0);
      }
   }
// <a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiU.html?is-external=true#str-java.lang.Object-long-" title="otsu.hiNote内のクラスまたはインタフェース"><code>hiU.str()</code></a>は構造を表示するメソッドです.
// hiU.WITH_INDENTはインデントを付加するオプションです。<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiFieldFormat.html?is-external=true#option" title="otsu.hiNote内のクラスまたはインタフェース"><code>hiFieldFormatオプション</code></a>参照
＊＊＊＊＊＊　dbデータ
> use db01
switched to db db01
> db.coll_01.find({},{_id:0})
{ "type" : "A", "value" : 12.3, "date" : ISODate("2020-08-17T07:07:00Z") }
{ "type" : "A", "value" : 4.56, "date" : ISODate("2020-08-17T07:07:10Z") }
{ "type" : "B", "value" : 2001, "date" : ISODate("2020-08-17T07:07:20Z") }
{ "type" : "A", "value" : 7.89, "date" : ISODate("2020-08-17T07:07:30Z") }
{ "type" : "A", "value" : 0.12, "date" : ISODate("2020-08-17T07:07:40Z") }
＊＊＊＊＊＊　ビルド実行結果
$ ./run.sh
----- 02classAssign -----
last=1597648060000 start=1597648030000
records=[
   {
      type="A",
      value=4.56,
      date=Mon Aug 17 16:07:10 JST 2020},
   {
      type="A",
      value=7.89,
      date=Mon Aug 17 16:07:30 JST 2020},
   {
      type="A",
      value=0.12,
      date=Mon Aug 17 16:07:40 JST 2020}]
min=0.12 max=7.89 avg=4.19
OK
</pre>
<p><input type="button" value="フルコードを隠す△" style="WIDTH:12em"
   onClick="document.getElementById('divClass_2').style.display='none';
            document.getElementById('divClass_1').style.display='block';
            document.location='#divClass_1'"></p>
</div>


<p class=B1_2 id=probe>
&emsp;汎用データ探索機<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Probe.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース"><code>hiJSON.Probe</code></a>で受け取る
</p>
<p>
型を特定せず、<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Probe.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース"><code>hiJSON.Probe</code></a>で受け取り、辞書アクセス、配列アクセスにより値を得ることができます。<br>
要素へのアクセスは文字列による名前での指定となります。
</p>
<pre class=quote10>
double _start_date=取得開始レコードのunixエポック
ArrayList&lt;hiJSON.Node> _recs
=db.get("coll_01")
   .find("{$and:["+
            "{type:'A'},"+
            "{date:{$gte:{$date:"+_start_date+"}}}"+
            "]}",
         "{_id:0}")
   .<span class=blue>getProbeList</span>();
<span class=gray>for(hiJSON.Probe _probe:_recs){
   System.out.println("value="+_probe.at("value").getDouble());
   }</span>
</pre>
<div id="divProbe_1">
<p><input type="button" value="フルコードを表示する" style="WIDTH:12em"
   onClick="document.getElementById('divProbe_2').style.display='block';
            document.getElementById('divProbe_1').style.display='none'"></p>
</div>
<div id="divProbe_2" style="display:none">
<p><input type="button" value="フルコードを隠す" style="WIDTH:12em"
   onClick="document.getElementById('divProbe_2').style.display='none';
            document.getElementById('divProbe_1').style.display='block'"></p>
<pre class=quote8>
import hi.hiMongo;
import otsu.hiNote.*;
import java.util.*;
public class Test {
   public static void main(String[] args_){
      try(hiMongo.DB db=hiMongo.use("db01")){
         //----------------------------------------------
         // 最後の'A'レコードの時刻(unix-epoch)を得る
         long _last_date
         =db.get("coll_01")
            .find("{type:'A'}","{_id:0,date:1}")
            .sort("{_id:-1}").limit(1)
            .getProbeList()
            .get(0).at("date").get(D->((Date)D).getTime());
         //----------------------------------------------
         // 最後のレコードの30秒前からの'A'レコード取得
         long _start_date= _last_date-30000; // 30秒前
         System.out.println("last="+_last_date+" start="+_start_date);
         ArrayList&lt;hiJSON.Probe> _recs
                 =db.get("coll_01")
                    .find("{$and:["+
                              "{type:'A'},"+
                              "{date:{$gte:{$date:"+_start_date+"}}}"+
                               "]}",
                           "{_id:0}")
                    .getProbeList();
         //----------------------------------------------
         // 最大、最少、平均を求める
         double _min  = Double.MAX_VALUE;
         double _max  = Double.MIN_VALUE;
         double _total= 0;
         for(hiJSON.Probe _probe:_recs){
            double _val= _probe.at("value").getDouble();
            _min    = Math.min(_min,_val);
            _max    = Math.max(_max,_val);
            _total += _val;
            }
         double _avg= _total/_recs.size();
         System.out.printf("min=%.2f max=%.2f avg=%.2f\n",_min,_max,_avg);
         }
      catch(Exception _ex){
         _ex.printStackTrace(System.err);
         System.exit(1);
         }
      System.exit(0);
      }
   }
＊＊＊＊＊＊　dbデータ
> use db01
switched to db db01
> db.coll_01.find({},{_id:0})
{ "type" : "A", "value" : 12.3, "date" : ISODate("2020-08-17T07:07:00Z") }
{ "type" : "A", "value" : 4.56, "date" : ISODate("2020-08-17T07:07:10Z") }
{ "type" : "B", "value" : 2001, "date" : ISODate("2020-08-17T07:07:20Z") }
{ "type" : "A", "value" : 7.89, "date" : ISODate("2020-08-17T07:07:30Z") }
{ "type" : "A", "value" : 0.12, "date" : ISODate("2020-08-17T07:07:40Z") }
＊＊＊＊＊＊　ビルド実行結果
$ ./run.sh
----- 03probeAccess -----
last=1597648060000 start=1597648030000
min=0.12 max=7.89 avg=4.19
OK
</pre>
<p><input type="button" value="フルコードを隠す△" style="WIDTH:12em"
   onClick="document.getElementById('divProbe_2').style.display='none';
            document.getElementById('divProbe_1').style.display='block';
            document.location='#divProbe_1'"></p>
</div>

<p class=B1 id="insert">
&emsp;insert/update/replace/delete/drop
</p>
<p>
レコードのinsertOne,insertMany,updateOne,updateMany,replaceOne,deleteOne,deleteMany,dropなどの操作も用意されています。
</p>
<p class=B1_2 id="insertOne">
&emsp;insert,drop(条件無)
</p>
<p>
insertOneの引数は１レコードの拡張JSON形式で、insertManyの引数はJSONの配列型です。<br>
それらを記述したテキストファイル、あるいはそれらの解析されたノードツリーも許されます。<br>
条件文は付きません。
</p>
<p>
次の様な使い方になります。get("コレクション")はその時点で存在しないコレクションに対して行っても構いません。なお<a href="../hi/hiMongo.html#date--"><code>hiMongo.date()</code></a>は現在時の標準JSON表現を得る関数です。
</p>
<pre class=quote10>
hiMongo.DB db =hiMongo.use("db01");
=db.get("coll_01")
   .insertOne(
     " {type:'A',value:12.3,date:"+hiMongo.date()+"}");
</pre>
<p>
dropはレコードの削除のみならずコレクションそのものの削除ですが、insertを繋げることにより、元の名前のコレクションが再び作成され空の状態でのレコード追加となります。
</p>
<pre class=quote10>
hiMongo.DB db =hiMongo.use("db01");
db.get("coll_01")
  .drop()
  .insertMany("["+
     " {type:'A',value:4.56,date:"+hiMongo.date()+"}"+
     ",{type:'B',value:2001,date:"+hiMongo.date()+"}"+
     ",{type:'A',value:7.89,date:"+hiMongo.date()+"}"+
     ",{type:'A',value:0.12,date:"+hiMongo.date()+"}]");
</pre>

<p class=B1_2 id="update">
&emsp;条件付き操作(delete,update,replace)
</p>
<p>
delete,update,replaceには対象となるレコードを選択する条件が付きます。
</p>
<p>
deleteでは条件に合致したレコードが削除されます。<br>
deleteOneでは登録の古いレコードが検索され、合致した一個のみが削除されます。<br>
deleteMabyでは合致するレコードが全て削除されます。
</p>
<pre class=quote10>
hiMongo.DB         db =hiMongo.use("db01");
hiMongo.Collection col=db.get("coll_01");
// --- deleteOne
coll.deleteOne("{type:'B'}");

// --- deleteMany
coll.deleteMany("{$and:[{type:'A'},{value:{$lt:8}}]}");
</pre>
<p>
updateは{$set:{フィールド名:値}}でフィールドの値の変更を指定します。<br>
複数フィールドの置き換えはフィールド名の値のセットをカンマで繋ぎます{$set:{フィールド1:値1,フィールド2:値2,...}<br>
存在しないフィールド名を指定するとフィールドの追加となります。
</p>


<pre class=quote10>
// --- updateOne
coll.updateOne("{$and:[{type:'B'},{value:{$gt:5}}]}",
               "{$set:{value:4.32}}");

// --- updateMany
coll.updateMany("{$and:[{type:'A'},{value:{$lt:5}}]}",
                "{$set:{value:3.21}}");
</pre>
<p>
replaceはレコード全体の置き換えになります。<br>
レコード全体を引数とします。
</p>
<pre class=quote10>
// --- replaceOne
coll.replaceOne("{$and:[{type:'A'},{value:{$lt:5}}]}",
                "{type:'B',value:6543,date:"+hiMongo.date()+"}");

</pre>

<div id="divInser_1">
<p><input type="button" value="フルコードを表示する" style="WIDTH:12em"
   onClick="document.getElementById('divInser_2').style.display='block';
            document.getElementById('divInser_1').style.display='none'"></p>
</div>
<div id="divInser_2" style="display:none">
<p><input type="button" value="フルコードを隠す" style="WIDTH:12em"
   onClick="document.getElementById('divInser_2').style.display='none';
            document.getElementById('divInser_1').style.display='block'"></p>
<pre class=quote8>
import hi.hiMongo;
import otsu.hiNote.*;
import java.util.*;
public class Test {
   public static void main(String[] args_){
      try(hiMongo.DB db =hiMongo.use("db01")){
         hiMongo.Collection  _coll=db.get("coll_01").drop();
         System.out.println("--- insertOne/insertMany");
         _coll.insertOne(
              " {type:'A',value:12.3,date:"+hiMongo.date()+"}");
         _coll.insertMany("["+
              " {type:'A',value:4.56,date:"+hiMongo.date()+"}"+
              ",{type:'B',value:2001,date:"+hiMongo.date()+"}"+
              ",{type:'A',value:7.89,date:"+hiMongo.date()+"}"+
              ",{type:'A',value:0.12,date:"+hiMongo.date()+"}]");
         _coll.find("{}","{_id:0}").forEach(R->System.out.println(R));

         System.out.println("--- updateOne");
         _coll.updateOne("{$and:[{type:'B'},{value:{$gt:5}}]}",
                         "{$set:{value:4.32}}");
         _coll.find("{}","{_id:0,date:0}").forEach(R->System.out.println(R));

         System.out.println("--- updateMany");
         _coll.updateMany("{$and:[{type:'A'},{value:{$lt:5}}]}",
                         "{$set:{value:3.21}}");
         _coll.find("{}","{_id:0,date:0}").forEach(R->System.out.println(R));

         System.out.println("--- replaceOne");
         _coll.replaceOne("{$and:[{type:'A'},{value:{$lt:5}}]}",
                         "{type:'B',value:6543,date:"+hiMongo.date()+"}");
         _coll.find("{}","{_id:0,date:0}").forEach(R->System.out.println(R));

         System.out.println("--- deleteOne");
         _coll.deleteOne("{type:'B'}");
         _coll.find("{}","{_id:0,date:0}").forEach(R->System.out.println(R));

         System.out.println("--- deleteMany");
         _coll.deleteMany("{$and:[{type:'A'},{value:{$lt:8}}]}");
         _coll.find("{}","{_id:0,date:0}").forEach(R->System.out.println(R));
         }
      catch(Exception _ex){
         _ex.printStackTrace(System.err);
         System.exit(1);
         }
      System.exit(0);
      }
   }
＊＊＊＊＊＊　ビルド実行結果
$ ./run.sh
----- 06insert -----
--- insertOne/insertMany
Document{{type=A, value=12.3, date=Tue Aug 25 03:08:53 JST 2020}}
Document{{type=A, value=4.56, date=Tue Aug 25 03:08:53 JST 2020}}
Document{{type=B, value=2001, date=Tue Aug 25 03:08:53 JST 2020}}
Document{{type=A, value=7.89, date=Tue Aug 25 03:08:53 JST 2020}}
Document{{type=A, value=0.12, date=Tue Aug 25 03:08:53 JST 2020}}
--- updateOne
Document{{type=A, value=12.3}}
Document{{type=A, value=4.56}}
Document{{type=B, value=4.32}}
Document{{type=A, value=7.89}}
Document{{type=A, value=0.12}}
--- updateMany
Document{{type=A, value=12.3}}
Document{{type=A, value=3.21}}
Document{{type=B, value=4.32}}
Document{{type=A, value=7.89}}
Document{{type=A, value=3.21}}
--- replaceOne
Document{{type=A, value=12.3}}
Document{{type=B, value=6543}}
Document{{type=B, value=4.32}}
Document{{type=A, value=7.89}}
Document{{type=A, value=3.21}}
--- deleteOne
Document{{type=A, value=12.3}}
Document{{type=B, value=4.32}}
Document{{type=A, value=7.89}}
Document{{type=A, value=3.21}}
--- deleteMany
Document{{type=A, value=12.3}}
Document{{type=B, value=4.32}}
OK
</pre>
<p><input type="button" value="フルコードを隠す△" style="WIDTH:12em"
   onClick="document.getElementById('divInser_2').style.display='none';
            document.getElementById('divInser_1').style.display='block';
            document.location='#divInser_1'"></p>
</div>

<p class=B1_2 id=cap>
&emsp;キャップ（最大容量)指定
</p>
<p>
hiMongol.DBの<a href="../hi/hiMongo.DB.html#createCappedCollection-java.lang.String-java.lang.String-"><code>createCappedCollection()</code></a>メソッドで、容量制限付きのコレクションを作成できます。<br>
既にあるコレクションの容量を変更することは出来ません。<br>
insertOne(),insertMany()を発行した場合、制限容量に達すると、古いレコードが削除されます。
</p>
<p>
createCappedCollection()にはコレクション名と、容量情報を指定します。<br>
容量情報はJSON形式の文字列で次の形となります。
</p>
<pre class=prog10>
{
   size   :<i>バイト数</i>,
   records:<i>レコード数</i>,
   force  :<i>trueまたはfalse</i>
   }
EX {size:1000000000,records:5000,force:true}
</pre>
<p>
forceがtrueだと必ず要素無しでcap指定のされたのコレクションを作成します。<br>
forceがfalseの場合すでにコレクションがあれば無処理となります。
</p>
<div id="divCap_1">
<p><input type="button" value="例を表示する" style="WIDTH:12em"
   onClick="document.getElementById('divCap_2').style.display='block';
            document.getElementById('divCap_1').style.display='none'"></p>
</div>
<div id="divCap_2" style="display:none">
<p><input type="button" value="例を隠す" style="WIDTH:10em"
   onClick="document.getElementById('divCap_2').style.display='none';
            document.getElementById('divCap_1').style.display='block'"></p>
<pre class=quote10>
import hi.hiMongo;
public class Test {
   public static void main(String[] args_){
      try(hiMongo.DB db=hiMongo.use("db01")){ 
         hiMongo.Collection col
         =db.createCappedCollection(
              "coll_cap",      // コレクション名
              "{size:10000,"+  // 最大容量（バイト)
              " records:5," +  // 最大レコード数
              " force:true}"   // 強制クリア
              );
         for(int _n=0;_n<20;++_n){
            col.insertOne("{type:'A',value:"+(_n+1)+"}");
            }
         col.find("{}","{_id:0}")
            .forEachMson(M->System.out.println(M));
         }
      catch(Exception _ex){
         _ex.printStackTrace(System.err);
         System.exit(1);
         }
      System.exit(0);
      }
   }
＊＊＊＊＊＊　ビルド実行結果
$ ./run.sh
----- 08cap -----
{'type':'A', 'value':16}
{'type':'A', 'value':17}
{'type':'A', 'value':18}
{'type':'A', 'value':19}
{'type':'A', 'value':20}
OK
</pre>
<p><input type="button" value="例を隠す△" style="WIDTH:10em"
   onClick="document.getElementById('divCap_2').style.display='none';
            document.getElementById('divCap_1').style.display='block';
            document.location='#divCap_1'"></p>
</div>

<p class=B1 id=aggre>
&emsp;aggregate(集計）の引数と結果
</p>
<p>
aggregateで集計を得ることができます。<br>
結果は利用者クラスで受け取ることができます。
</p>
<pre class=quote10>
<span class=red>class Arec</span> {
   String _id;
   double min;
   double max;
   double avg;
   }
----
double _start_date=取得開始レコードのunixエポック
<span class=red>Arec</span> _r
=db.get("coll_01")
   .aggregate("["+
      "{ $match:{$and:["+
         "{type:'A'},"+
         "{date:{$gte:{$date:"+_start_date+"}}}"+
         "]}},"+
      "{ $group:{"+
         "_id:'$type',"+
         "min:{$min:'$value'},"+
         "max:{$max:'$value'},"+
          "avg:{$avg:'$value'}}}"+
      "]")
   .getClassList(<span class=red>Arec.class</span>).get(0);
System.out.printf("min=%.2f max=%.2f avg=%.2f"
                  ,_r.min,_r.max,_r.avg));
</pre>
<p>
これは次のmongo-shell記述に相当します。
</p>
<pre class=quote10>
var _isodate=new Date(取得開始レコードのunixエポック)
var _r=
db.coll_01.
   aggregate([
    { $match:{$and:[
            {type:'A'},
            {date:{$gte:_isodate}}
            ]}},
    { $group:{_id:"$type",
          min:{$min:"$value"},
          max:{$max:"$value"},
          avg:{$avg:"$value"}}}
     ]).
   toArray()[0];
print("min="+_r.min+" max="+_r.max+" avg="+_r.avg.toFixed(2));
</pre>

<div id="divAggre_1">
<p><input type="button" value="フルコードを表示する" style="WIDTH:12em"
   onClick="document.getElementById('divAggre_2').style.display='block';
            document.getElementById('divAggre_1').style.display='none'"></p>
</div>
<div id="divAggre_2" style="display:none">
<p><input type="button" value="フルコードを隠す" style="WIDTH:12em"
   onClick="document.getElementById('divAggre_2').style.display='none';
            document.getElementById('divAggre_1').style.display='block'"></p>
<pre class=quote8>
// このプログラムでは先ず最後のレコードのdate情報を取得し、それから
// 30秒前からのレコードの統計情報をaggregateで取得しています。
import hi.hiMongo;
import otsu.hiNote.*;
import java.util.*;
import java.io.*;
public class Test {
   static class Arec {
      String _id;
      double min;
      double max;
      double avg;
      }
   static class WithDate {
      Date date;
      }
   public static void main(String[] args_){
      try(hiMongo.DB db=hiMongo.use("db01")){
         long _start_date
         = db.get("coll_01")
              .find("{type:'A'}","{_id:0,date:1}")
              .sort("{_id:-1}").limit(1).getClassList(WithDate.class)
              .get(0).date.getTime()-30000;
         Arec _r
         = db.get("coll_01")
              .aggregate("["+
                "{ $match:{$and:["+
                    "{type:'A'},"+
                    "{date:{$gte:{$date:"+_start_date+"}}}"+
                    "]}},"+
                "{ $group:{"+
                     "_id:'$type',"+
                     "min:{$min:'$value'},"+
                     "max:{$max:'$value'},"+
                     "avg:{$avg:'$value'}}}"+
                "]")
              .getClassList(Arec.class).get(0);
         System.out.println(String.format("min=%.2f max=%.2f avg=%.2f"
                                          ,_r.min,_r.max,_r.avg));
         }
      catch(Exception _ex){
         _ex.printStackTrace(System.err);
         System.exit(1);
         }
      System.exit(0);
      }
   }
＊＊＊＊＊＊　dbデータ
> use db01
switched to db db01
> db.coll_01.find({},{_id:0})
{ "type" : "A", "value" : 12.3, "date" : ISODate("2020-08-17T07:07:00Z") }
{ "type" : "A", "value" : 4.56, "date" : ISODate("2020-08-17T07:07:10Z") }
{ "type" : "B", "value" : 2001, "date" : ISODate("2020-08-17T07:07:20Z") }
{ "type" : "A", "value" : 7.89, "date" : ISODate("2020-08-17T07:07:30Z") }
{ "type" : "A", "value" : 0.12, "date" : ISODate("2020-08-17T07:07:40Z") }
＊＊＊＊＊＊　ビルド実行結果
$ ./run.sh
----- 04aggregate -----
start=1597648030000
min=0.12 max=7.89 avg=4.19
OK
</pre>
<p><input type="button" value="フルコードを隠す△" style="WIDTH:12em"
   onClick="document.getElementById('divAggre_2').style.display='none';
            document.getElementById('divAggre_1').style.display='block';
            document.location='#divAggre_1'"></p>
</div>






<p class=B1 id="lookup">
&emsp;aggregate(集計）lookupによるフィールド結合
</p>
<p>
aggregateの$lookupを用いれば異なるコレクションのレコード・フィールドを結合することができます。<br>
結合されたデータは利用者定義の型のリストで受け取ることができます。
</p>
<pre class=quote10>
class A_Rec {
   String       店舗名;
   int          数量;
   from商品_Rec from商品;
   static class from商品_Rec{
      String 商品名;
      int    販売単価;
      }
   }
---
ArrayList&lt;A_Rec> _recs
=db.get("店舗商品")
   .aggregate("["+
      "{$match:{$or:["+
           "{'店舗名':'東京'},"+
           "{'店舗名':'福岡'}"+
           "]}},"+
      "{$lookup:{"+
          "from:'商品',"+
          "localField:'商品id',"+
          "foreignField:'商品id',"+
          "as:'from商品'"+
          "}},"+
      "{$project:{"+
          "'_id':0,"+
          "'店舗名':1,"+
          "'from商品.商品名':1,"+
          "'from商品.販売単価':1,"+
          "'数量':1}},"+
       "{$unwind:'$from商品'}"+
      "]")
    .getClassList(A_Rec.class);
<span class=gray>for(A_rec _rec:_recs){
   System.out.println(_rec.店舗名+" "+_rec.from商品.商品名
                      +" 数量:"+_rec.数量);
   }</span>
</pre>
<p>
mongo-shellの次の記述に相当します。
</p>
<pre class=quote10>
use sampleDB
db.店舗商品.
    aggregate([
       {$match:{$or:[
          {'店舗名':'東京'},
          {'店舗名':'福岡'}
          ]}},
      {$lookup:{
         from:'商品',
         localField:'商品id',
         foreignField:'商品id',
         as:'from商品'
         }},
      {$project:{
         '_id':0,
         '店舗名':1,
         'from商品.商品名':1,
         'from商品.販売単価':1,
         '数量':1}},
     {$unwind:'$from商品'}
    ]);
</pre>

<div id="div_1">
<p><input type="button" value="フルコードを表示する" style="WIDTH:12em"
   onClick="document.getElementById('div_2').style.display='block';
            document.getElementById('div_1').style.display='none'"></p>
</div>
<div id="div_2" style="display:none">
<p><input type="button" value="フルコードを隠す" style="WIDTH:12em"
   onClick="document.getElementById('div_2').style.display='none';
            document.getElementById('div_1').style.display='block'"></p>
<pre class=quote8>
// 東京あるいは福岡の店舗にある商品名と個数を得ています。
// 商品名は店舗商品コレクションの"商品id"で商品コレクションを連結し
// 商品名を得ています。
import hi.hiMongo;
import otsu.hiNote.*;
import java.util.*;
public class Test {
   static class A_Rec {
      String       店舗名;
      int          数量;
      from商品_Rec from商品;
      static class from商品_Rec{
         String 商品名;
         int    販売単価;
         }
      }
   public static void main(String[] args_){
      try(hiMongo.DB db=hiMongo.use("sampleDB")){
         ArrayList&lt;A_Rec&gt; _recs=
         db.get("店舗商品").aggregate("["+
               "{$match:{$or:["+
                    "{'店舗名':'東京'},"+
                    "{'店舗名':'福岡'}"+
                    "]}},"+
               "{$lookup:{"+
                   "from:'商品',"+
                   "localField:'商品id',"+
                   "foreignField:'商品id',"+
                   "as:'from商品'"+
                   "}},"+
               "{$project:{"+
                   "'_id':0,"+
                   "'店舗名':1,"+
                   "'from商品.商品名':1,"+
                   "'from商品.販売単価':1,"+
                   "'数量':1}},"+
                "{$unwind:'$from商品'}"+
               "]")
            .getClassList(A_Rec.class);
          for(A_Rec _rec:_recs){
             System.out.println(_rec.店舗名+" "+_rec.from商品.商品名+" 数量:"+_rec.数量);
             }
         }
      catch(Exception _ex){
         _ex.printStackTrace(System.err);
         System.exit(1);
         }
      System.exit(0);
      }
   }
＊＊＊＊＊＊　dbデータ
> use sampleDB
switched to db sampleDB
> db.商品.find({},{_id:0,登録日:0})
{ "商品id" : "0001", "商品名" : "Tシャツ", "商品分類" : "衣服", "販売単価" : 1000, "仕入単価" : 500 }
{ "商品id" : "0002", "商品名" : "穴あけパンチ", "商品分類" : "事務用品", "販売単価" : 500, "仕入単価" : 320 }
{ "商品id" : "0003", "商品名" : "カッターシャツ", "商品分類" : "衣服", "販売単価" : 4000, "仕入単価" : 2800 }
{ "商品id" : "0004", "商品名" : "包丁", "商品分類" : "キッチン用品", "販売単価" : 3000, "仕入単価" : 2000 }
{ "商品id" : "0005", "商品名" : "フォーク", "商品分類" : "キッチン用品", "販売単価" : 500, "仕入単価" : 300 }
{ "商品id" : "0006", "商品名" : "ステイプラー", "商品分類" : "事務用品", "販売単価" : 880, "仕入単価" : 500 }
{ "商品id" : "0007", "商品名" : "ボールペン", "商品分類" : "事務用品", "販売単価" : 100, "仕入単価" : 20 }
> db.店舗商品.find({},{_id:0,更新日:0})
{ "店舗id" : "000A", "店舗名" : "東京", "商品id" : "0001", "数量" : 30 }
{ "店舗id" : "000A", "店舗名" : "東京", "商品id" : "0002", "数量" : 50 }
{ "店舗id" : "000A", "店舗名" : "東京", "商品id" : "0003", "数量" : 15 }
{ "店舗id" : "000B", "店舗名" : "名古屋", "商品id" : "0002", "数量" : 30 }
{ "店舗id" : "000B", "店舗名" : "名古屋", "商品id" : "0003", "数量" : 120 }
{ "店舗id" : "000B", "店舗名" : "名古屋", "商品id" : "0004", "数量" : 20 }
{ "店舗id" : "000B", "店舗名" : "名古屋", "商品id" : "0006", "数量" : 10 }
{ "店舗id" : "000B", "店舗名" : "名古屋", "商品id" : "0007", "数量" : 40 }
{ "店舗id" : "000C", "店舗名" : "大阪", "商品id" : "0003", "数量" : 20 }
{ "店舗id" : "000C", "店舗名" : "大阪", "商品id" : "0004", "数量" : 50 }
{ "店舗id" : "000C", "店舗名" : "大阪", "商品id" : "0006", "数量" : 90 }
{ "店舗id" : "000C", "店舗名" : "大阪", "商品id" : "0007", "数量" : 70 }
{ "店舗id" : "000D", "店舗名" : "福岡", "商品id" : "0001", "数量" : 100 }
＊＊＊＊＊＊　ビルド実行結果
$ ./run.sh
----- 05lookup -----
東京 Tシャツ 数量:30
東京 穴あけパンチ 数量:50
東京 カッターシャツ 数量:15
福岡 Tシャツ 数量:100
OK
</pre>
<p><input type="button" value="フルコードを隠す△" style="WIDTH:12em"
   onClick="document.getElementById('div_2').style.display='none';
            document.getElementById('div_1').style.display='block';
            document.location='#div_1'"></p>
</div>




<p class=B1 id="mson">
&emsp;mongoDB拡張JSON(mson)記述
</p>
<p>
hiMongoはmongoDBの拡張JSON記述のパーザ、表記生成器の機能も持ちます。
</p>
<p>
パーズ結果は汎用オブジェクト（nodeツリー）または利用者クラスになります。
</p>
<p>
汎用オブジェクトレベルではmongoDBの<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a>と内部形式のほぼ互換性を保っています。
</p>

<p class=B1_2 id="quote">
&emsp;引用符
</p>
<p>
英文字あるいは$で始まり英数字が続くフィールド名は引用符の省略が可能です。
</p>
<p>
引用符はダブルクオート、シングルクオート何れも可能です。
</p>
<pre class=quote10>
db.get("XX").find("{\"name\":\"A\"}")// 標準
db.get("XX").find("{name:\"A\"}")// 通常フィールド名引用符省略可
db.get("XX").find("{name:'A'}")// シングルクオート可
</pre>
<p>
出力はmsonではシングルクオート、jsonはダブルクオートとしています。
</p>

<p class=B1_2 id="date">
&emsp;ObjectId,Dateと数値
</p>
<p>
mongo拡張JSON(mson:bsonパーザ)で気を付ける必要があるのが、<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/types/ObjectId.html?is-external=true" title="org.bson.types内のクラスまたはインタフェース"><code>ObjectId</code></a>と<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/util/Date.html?is-external=true" title="java.util内のクラスまたはインタフェース"><code>Date</code></a>および数値です。
</p>
<p>
これらは次の表現形を持ちます。
</p>

<p>
<table class=t>
<table class=t>

<tr>
<td>型</td>
<td>bson(内部値)</td>
<td>mson表現</td>
<td>json表現</td>
<td>stringify表現</td>
</tr>

<tr>
<td>ObjectId</td>
<td>ObjectId</td>
<td>ObjectId("...")</td>
<td>{$oid:"..."}</td>
<td>{$oid:"..."}</td>
</tr>

<tr>
<td>Date</td>
<td>Date</td>
<td>ISODate("...")<br>
shell入力:new Date(unixEpoch)</td>
<td>{$date:unixEpoch}
<td>"..."<br>入力不可</td>
</tr>


<tr>
<td>int</td>
<td>Integer</td>
<td>NumberInt("...")</td>
<td>{$numberInt:数値}</td>
<td>数値</td>
</tr>


<tr>
<td>long</td>
<td>Long</td>
<td>NumberLong("...")</td>
<td>{$numberLong:数値}</td>
<td>数値</td>
</tr>

<tr>
<td>double</td>
<td>Double</td>
<td>数値</td>
<td>数値</td>
<td>数値</td>
</tr>


<tr>
<td>BigDecimal</td>
<td>Decimal128</td>
<td>NumberDecimal("...")<br>
数値入力不可</td>
<td>{$numberDecimal:"..."}<br>
数値入力不可</td>
<td>数値<br>
入力不可
</td>
</tr>

</table>
</p>
<p>
mongo-shellでは{...}系の入力はできません。指定名("$date"など)要素を持つ構造になってしまいます。
<br>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a>パーザは19桁を超える数値を扱えません。NumberDecimal(..)または{$numberDecimal:..}を使う必要があります。<br>
</p>
<p>
hiMongoでは次の扱いとなります。
</p>
<p>
<table class=t>

<tr>
<td>型</td>
<td>Object(内部値)</td>
<td>mson表現</td>
<td>json表現</td>
</tr>

<tr>
<td>ObjectId</td>
<td>ObjectId</td>
<td>ObjectId("...")</td>
<td>{$oid:"..."}</td>
</tr>

<tr>
<td>Date</td>
<td>Date</td>
<td>ISODate("...")
</td>
<td>{$date:unixEpoch}</td>

</tr>

<tr>
<td>int</td>
<td>Long</td>
<td>数値<br>
NumberInt("...")可</td>
<td>{$numberLong:数値}</td>
</tr>

<tr>
<td>long</td>
<td>Long</td>
<td>数値<br>
NumberLong("...")可</td>
<td>{$numberLong:数値}</td>
</tr>

<tr>
<td>double</td>
<td>Double</td>
<td>数値</td>
<td>数値</td>
</tr>


<tr>
<td>BigDecimal</td>
<td>BigDecimal</td>
<td>NumberDecimal("...")<br>
数値入力可
</td>
<td>{$numberDecimal:"..."}</td>
</td>
</tr>

</table>

</table>
</p>
<p>
hiMongoのパーザには桁数制限は有りません。hiMongoのパーズでは17桁までの整数はLong、仮数15桁まで指数15以下浮動小数はDouble、それ以外はBigDecimalとなります。BigDecimalはbsonになる時点でNumberDecimalとなります。<br>
hiMongoのBigDecimal表示をNumberDecimal形式にしてあるのは数値ではbsonパーザが取り扱えないからです。
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a>内部データは<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a>特有のクラスがありhiMongo内部データのJava標準のクラスとは異なりますが互いに変換可能です。
</p>
<p>
利用者クラスにマッピングする場合、数値はどの形でも利用者クラスの要素型になります。ただし、桁あふれは無視されます。
</p>


<div id="div_dateQuote1">
<p><input type="button" value="例を表示する" style="WIDTH:12em"
   onClick="document.getElementById('div_dateQuote2').style.display='block';
            document.getElementById('div_dateQuote1').style.display='none'"></p>
</div>
<div id="div_dateQuote2" style="display:none">
<p><input type="button" value="例を隠す" style="WIDTH:12em"
   onClick="document.getElementById('div_dateQuote2').style.display='none';
            document.getElementById('div_dateQuote1').style.display='block'"></p>
<pre class=quote8>
// ISODate(...),{$date:...}いずれもDate型になります。
// 要素名の引用符は省略可能です。（付けることも可）
// 値の引用符はシングルクオートでも構いません。（ダブルクオートも可）
import hi.hiMongo;
import otsu.hiNote.*;
import java.util.*;
import org.bson.Document;
public class Test {
   public static void main(String[] args_){
      String _filter
      ="{$and:["+
                "{type :'A'},"+
                "{date :{$gte:ISODate('2020-08-17T07:07:00.000Z')}},"+
                "{date2:{$gte:{$date:1597648021000}}}"+
              "]}";
      System.out.println("-- org.bson.Document");
      Document _doc=Document.parse(_filter);
      System.out.println("doc        ="+_doc);
      System.out.println("doc.toJson ="+_doc.toJson());
      System.out.println("-- hi.hiMongo");
      Object _node=hiMongo.parseText(_filter).asNode();
      System.out.println("node/mson  ="+hiMongo.mson(_node));
      System.out.println("node/json  ="+hiMongo.json(_node));
      System.out.println("---------");
      System.out.println("doc/Object ="+hiU.str(_doc,hiU.WITH_TYPE|hiU.WITH_INDENT));
      System.out.println("node/Object="+hiU.str(_node,hiU.WITH_TYPE|hiU.WITH_INDENT));
      }
   }
＊＊＊＊＊＊　ビルド実行結果
----- 07date -----
-- org.bson.Document
doc        =Document{{$and=[Document{{type=A}}, Document{{date=Document{{$gte=Mon Aug 17 16:07:00 JST 2020}}}}, Document{{date2=Document{{$gte=Mon Aug 17 16:07:01 JST 2020}}}}]}}
doc.toJson ={"$and": [{"type": "A"}, {"date": {"$gte": {"$date": 1597648020000}}}, {"date2": {"$gte": {"$date": 1597648021000}}}]}
-- hi.hiMongo
node/mson  ={"$and":[{"type":"A"}, {"date":{"$gte":ISODate("2020-08-17T07:07:00.000Z")}}, {"date2":{"$gte":ISODate("2020-08-17T07:07:01.000Z")}}]}
node/json  ={"$and":[{"type":"A"}, {"date":{"$gte":{"$date":1597648020000}}}, {"date2":{"$gte":{"$date":1597648021000}}}]}
---------
doc/Object =(Document){
   (String)"$and"=(ArrayList)[
      (Document){
         (String)"type"=(String)"A"},
      (Document){
         (String)"date"=(Document){
            (String)"$gte"=(Date)Mon Aug 17 16:07:00 JST 2020}},
      (Document){
         (String)"date2"=(Document){
            (String)"$gte"=(Date)Mon Aug 17 16:07:01 JST 2020}}]}
node/Object=(LinkedHashMap){
   (String)"$and"=(ArrayList)[
      (LinkedHashMap){
         (String)"type"=(String)"A"},
      (LinkedHashMap){
         (String)"date"=(LinkedHashMap){
            (String)"$gte"=(Date)Mon Aug 17 16:07:00 JST 2020}},
      (LinkedHashMap){
         (String)"date2"=(LinkedHashMap){
            (String)"$gte"=(Date)Mon Aug 17 16:07:01 JST 2020}}]}
OK
</pre>
<p><input type="button" value="例を隠す△" style="WIDTH:12em"
   onClick="document.getElementById('div_dateQuote2').style.display='none';
            document.getElementById('div_dateQuote1').style.display='block';
            document.location='#div_dateQuote1'"></p>
</div>

<!--
<p class=B1_2 id="regex">
&emsp;正規表現
</p>
<p>
スラッシュで囲めば正規表現と解釈されます。<br>
終端スラッシュの後ろには１文字のオプションが付けられます。
</p>
<pre class=quote10>
db.get("XX").find({name:/BC/i}).... 文字列BC(小文字可)を含む
db.get("XX").find({name:/^B.*n$/}).... Bで始まりnで終わる
db.get("XX").find({name:/(ra|re)/}).... 'ra'または're'を含む
</pre>
<p>
次の表現形を持ちます。
</p>
<p>
<table class=t>
<tr>
<td>型</td>
<td>bson(内部値)</td>
<td>mson表現</td>
<td>json表現</td>
</tr>

<tr>
<td>正規表現</td>
<td>BsonRegularExpression</td>
<td>{$regex:"..",$option:".."}<br>
/.../[.]入力のみ</td>
<td>{$regex:"..",$option:".."}</td>
</tr>

</table>
</p>
<p>
hiMongoでは次の扱いとなります。
</p>

<p>
<table class=t>

<tr>
<td>型</td>
<td>Object(内部値)</td>
<td>mson表現</td>
<td>json表現</td>
</tr>

<tr>
<td>正規表現</td>
<td>BsonRegularExpression</td>
<td>{$regex:"..",$option:".."}<br>
/.../[.]入力のみ</td>
<td>{$regex:"..",$option:".."}</td>
</tr>

</table>
</p>
-->

<p class=B1_2 id="comment">
&emsp;コメント等のhiMongo拡張(hson)
</p>
<p>
標準ではmson記述はコメントを受け付けません。<br>
hiMongo
hiMongo.parseXX(...).asNode()を用いて汎用Objectノードツリー化すればコメントの記述も可能です。<br>
また、hiMongo.parseXX(...).asNodeList()を用いれば複数レコードがただ並ぶだけでJSONの配列形式を採らない記述も受け付けinserManyなどの引数に出来ます。
</p>
<p>
例えば次の記述をinsertManyに与えることが出来ます。
</p>
<pre class=quote8>
// 作曲家リスト
// 出生国と異なる国に移住し活躍した場合はnationalityに
// 出生国,移住国の順で記述
// ご存命の場合はlifeTimeに出生年のみ記述

{famiryName:'Bach',givenName:['Johann','Sebastian'],
 nationality:['独'],lifeTime:[1685,1750]}

{famiryName:'Bartók',givenName:['Béla'],
 nationality:['ハンガリー','米'],lifeTime:[1881,1945]}

{famiryName:'Beethoven',givenName:['Ludwig','van'],
 nationality:['独'],lifeTime:[1770,1827]}

{famiryName:'Brahms',givenName:['Johannes'],
 nationality:['独'],lifeTime:[1833,1897]}

{famiryName:'Chopin',givenName:['Frédéric-Françoic'],
 nationality:['ポーランド','仏'],lifeTime:[1810,1849]}
</pre>
<p>
プログラムの断片を示します。<br>
with_hson()指定をすれば、hson拡張文字列を取り扱えます。
</p>
<pre class=quote10>
//-- with_hson()を発行した上で文字列を直接与える方法
String <span class=blue>_records_json</span>=hiFile.readTextAll("data.json");
hiMongo.DB db=hiMongo.use("db01");
db.get("composer").drop()
  <span class=red>.with_hson()</span>
  .insertMany(<span class=blue>_records_json</span>);
</pre>
<p>
ファイル入力の場合Stringに落とすことなくFileを直接指定することも可能です。
</p>
<pre class=quote10>
//-- with_hson()を発行した上でFile指定
hiMongo.DB db=hiMongo.use("db01");
db.get("composer").drop()
  <span class=red>.with_hson()</span>
  .insertMany(<span class=purple>new File("data.json")</span>);
</pre>
<p>
with_hson()指定を行わず、一旦hiMongo.parseText().adNodeList()でノードレベルまで解析した結果を与えることも出来ます。<br>
</p>
<pre class=quote10>
//-- パーズ結果を使う方法
String <span class=blue>_records_json</span>=hiFile.readTextAll("data.json");
Object <span class=green>_recodes_node</span>=hiMongo.parseText(<span class=blue>_records_json</span>)
                            .asNodeList();
hiMongo.DB db=hiMongo.use("db01");
db.get("composer").drop()
  .insertMany(<span class=green>_recodes_node</span>);
</pre>



<p class=B1 id="remote">
&emsp;リモート接続
</p>
<p>
リモートホストに置かれたデータベースアクセスすることができます。
</p>
<p class=B1_2>
&emsp;リモート側（サーバ側）設定
</p>
<p class=c>
&emsp;外部からのアクセスを許すhost設定
</p>
<p>
リモート側ではmongodb設定でbind_ipにアクセスを許可するhostを指定する必要があります。
</p>
<pre class=quote10>
設定ファイル /etc/mongodb.conf
設定内容     #bind_ip = 127.0.0.1 # コメントアウト
             bind_ip = 0.0.0.0    # 追加
</pre>
<p>
0.0.0.0は全てのホストを許可する指定です。セキュリティを考慮すると、個別hostを記述したほうがよいでしょう。
なおmongoDBのバージョンにより記述法に差があるようです。
</p>
<p class=c>
&emsp;外部からのアクセスを許すユーザ設定
</p>
<p>
アクセスを許すユーザの設定をmongo-shellを使って設定します。<br>
例を示します。ここで指定するDBは利用者設定DBであり、利用者がデータ用に用いるDBとは別です。
</p>
<pre class=quote10>
$ mongo
> use <span class=red>testDB</span>;
> db.createUser({
     user:'<span class=blue>testUser</span>',
     pwd:'<span class=green>xxx</span>',
     roles:[
        {role:'dbOwner',db:'<span class=red>testDB</span>'}
        ]
     });
> exit;
</pre>

<p class=B1_2>
&emsp;クライアント側アクセス
</p>
<p class=c>
&emsp;mongo-shellでアクセス
</p>
<p>
次のような形でサーバとは別のPCからmongo-shellアクセスができます。
</p>
<pre class=quote10>
$ mongo -u <span class=blue>testUser</span> -p <span class=green>xxx</span> --host <i>192.168.1.139</i> <span class=red>testDB</span>
>
</pre>

<p class=c>
&emsp;hiMongoによるJavaプログラムアクセス
</p>
<p>
use()の前にconnect()メソッドにJSON文字列またはhiMongo.RemoteInfoで接続先の情報を指定します。
</p>
<pre class=quote10>
//---- JSON文字列で情報を与える
DB db=hiMongo.connect("{"+
                      "host:'192.168.1.139',"+
                      "port:27017,"+
                      "dbName:'<span class=red>testDB</span>',"+
                      "user:'<span class=blue>testUser</span>',"+
                      "password:'<span class=green>xxx</span>'"+
                      "}")
              .use("<span class=purple>db01</span>");// 利用者が使うDBはdb01
db.get("coll_01").find()...
</pre>
<p>
または
</p>
<pre class=quote10>
//---- クラス(hiMongo.RemoteInfo)で情報を与える
hiMongo.RemoteInfo _info=new hiMongo.RemoteInfo();
_info.host    = "192.168.1.139";
_info.port    = 27017;
_info.dbName  = "<span class=red>testDB</span>";
_info.user    = "<span class=blue>testUser</span>";
_info.password= "<span class=green>xxx</span>";
DB db=hiMongo.connect(_info)
             .use("<span class=purple>db01</span>");// 利用者が使うDBはdb01
db.get("coll_01").find()...
</pre>

<p class=B1 id="driver">
&emsp;driver-APIを使う
</p>
<p>
hiMongoの各クラスが持つmongodb-java-driverの要素にアクセスすることが出来ます。
</p>
<table class=t>
<tr><td>driverのクラス/インターフェース</td><td>hiMongo要素</td></tr>
<tr>
<td>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/MongoClient.html?is-external=true" title="com.mongodb内のクラスまたはインタフェース"><code>MongoClient</code></a>
</td>
<td>
<a href="../hi/hiMongo.Client.html#mongoClient"><code>hiMongo.Client.mongoClient</code></a>
</td>
</tr>

<tr>
<td>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/client/MongoDatabase.html?is-external=true" title="com.mongodb.client内のクラスまたはインタフェース"><code>MongoDatabase</code></a>
</td>
<td>
<a href="../hi/hiMongo.DB.html#mongoDatabase"><code>hiMongo.DB.mongoDatabase</code></a>
</td>
</tr>

<tr>
<td>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/client/MongoCollection.html?is-external=true" title="com.mongodb.client内のクラスまたはインタフェース"><code>MongoCollection&lt;TDocument&gt;</code></a>
</td>
<td>
<a href="../hi/hiMongo.Collection.html#mongoCollection"><code>hiMongo.Collection.mongoCollection</code></a>
</td>
</tr>

<tr>
<td>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/client/FindIterable.html?is-external=true" title="com.mongodb.client内のクラスまたはインタフェース"><code>FindIterable&lt;TResult&gt;</code></a>
</td>
<td>
<a href="../hi/hiMongo.Finder.html#getIterator--"><code>hiMongo.Finder.getIterator()</code></a>
</td>
</tr>

<tr>
<td>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/client/AggregateIterable.html?is-external=true" title="com.mongodb.client内のクラスまたはインタフェース"><code>AggregateIterable&lt;TResult&gt;</code></a>
</td>
<td>
<a href="../hi/hiMongo.Aggregrator.html#getIterator--"><code>hiMongo.Aggregrator.getIterator()</code></a>
</td>
</tr>

</table>



<p class=c id=createIndex>
&emsp;例：MongoCollection&lt;TDocument&gt;.createIndex
</p>
<p>
例えばcreateIndexはhiMongo(0.05)では用意していませんが、hiMongo.CollectionのmongoCollectionを参照し次のようにして実施することが出来ます。
</p>
<pre class=quote10>
import hi.hiMongo;
import org.bson.Document;
import com.mongodb.client.model.IndexOptions;
public class Test {
   public static void main(String[] args_){
      try(hiMongo.DB db=hiMongo.use("sampleDB")){
         <span class=gray>System.out.println("--- befor creteIndex");
         for(Document doc:db.get("商品").mongoCollection.listIndexes()){System.out.println(doc);}</span>
         <b>db.get("商品").mongoCollection.createIndex(Document.parse("{商品id:1}"),
                                                   new IndexOptions().unique(true));</b>
         <span class=gray>System.out.println("--- after creteIndex");
         for(Document doc:db.get("商品").mongoCollection.listIndexes()){System.out.println(doc);}</span>
         //...
         }
      }
   }
</pre>

<p class=c id=createIndex>
&emsp;例：FindIterable&lt;TResult&gt;.showRecordId
</p>
<p>
カスケードAPIの流れの中に組み込むにはforThisを用います。forThisはthisをラムダ式に与えて処理後、thisを返しますので、カスケードAPIを連続させることが出来ます。
</p>
<pre class=quote10>
<span class=gray>db.get("coll_01")
  .find("{type:'A'}")
  .sort("{_id:-1}")
  .limit(3)</span>
  <b>.forThis(T->T.getIterator().showRecordId(true))</b>
  <span class=gray>.forEachJson(J->System.out.println(J));</span>
</pre>

<p class=B1 id="node">
&emsp;node(Object,Document)の取り扱いx
</p>
<div id="divNode_1">
<p><input type="button" value="説明を表示する" style="WIDTH:10em"
   onClick="document.getElementById('divNode_2').style.display='block';
            document.getElementById('divNode_1').style.display='none'"></p>
</div>
<div id="divNode_2" style="display:none">
<p><input type="button" value="説明を隠す" style="WIDTH:10em"
   onClick="document.getElementById('divNode_2').style.display='none';
            document.getElementById('divNode_1').style.display='block'"></p>
<p>
hiMongoではクエリー情報やレコード情報は拡張JSON文字列で与えることを基本とします。
</p>
<p>
これらはプログラムで手続き的に作成されたノードオブジェクトの形で与えることも可能です。<br>
Document.parse(xxx)またはhiMongo.parse(xxx).asNode()で得ることも出来ます。
</p>
<p>
ノードオブジェクトは辞書(Map)、リスト（List)、文字列他単純値で構成されます。<br>
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a>はHashMap<String,Object>の派生でappendなどノード構成用のメソッドが追加されています。
</p>
<p>
例えば{type:'A'}をfindに与えるコードは次のように書くことができます。
</p>
<pre class=quote10>
HashMap<String,Object> filter=new HashMap<>();
filter.put("type","A");
hiMongo.use("db01").get("coll_01").find(filter)
       .forEach(D->System.out.prinln(D));
</pre>
<p>
少し複雑な条件だとHashMapで書くのは困難になります。<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>Document</code></a>のappendを用いれば一応記述は可能です。<br>
例えば{$and[{type:'A'},{value:{lt:1}}]}をfindに与えるコードは次のように書くことができます。
</p>
<pre class=quote10>
import <a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/Document.html?is-external=true" title="org.bson内のクラスまたはインタフェース"><code>org.bson.Document</code></a>;
-------
Document filter
=new Document()
     .append("$and",
         Arrays.asList(
            new Document()
               .append("type","A"),
            new Document()
               .append("value",
                   new Document()
                      .append("$lt",1))
            )
      );
hiMongo.use("db01").get("coll_01").find(filter)
       .forEach(D->System.out.prinln(D));
</pre>
<p>
これでも記述としては煩雑過ぎるのでmongo-java-driverには、JSONのノードの形からは完全に逸脱した
<a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/conversions/Bson.html?is-external=true" title="org.bson.conversions内のクラスまたはインタフェース"><code>Bson</code></a>というクラスが用意されています。<br>
次の様に使う事ができます。
</p>
<pre class=quote10>
import <a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/org/bson/conversions/Bson.html?is-external=true" title="org.bson.conversions内のクラスまたはインタフェース"><code>org.bson.conversions.Bson</code></a>;
import <a target="_blank" rel="noopener noreferrer" href="http://mongodb.github.io/mongo-java-driver/3.7/javadoc/com/mongodb/client/model/Filters.html?is-external=true" title="com.mongodb.client.model内のクラスまたはインタフェース"><code>com.mongodb.client.model.Filters</code></a>;
-------
Bson filter   // Documentではない！
=Filters.and(
    Filters.eq("type","A"),
    Filters.lt("value",1)
    );
</pre>
<p>
Documentは受け付けるけどBsonは受け付けないなどmongo-json-driverのAPIに混乱が見られますので、hiMongoでは受け付けないようにしています。
</p>
<p>
Documentと(Filtersが返す)Bsonの内部形式は次の様になっています。
</p>
<pre class=quote10>
//---- Document (辞書構成となっています)
filter=(Document){
   (String)"$and"=(Arrays$ArrayList)[
      (Document){
         (String)"type"=(String)"A"},
      (Document){
         (String)"value"=(Document){
            (String)"$lt"=(Integer)1}}]}

//---- Bson (辞書ではなく専用クラスが割り当てられています）
filter=(Filters$AndFilter){
   filters=(Arrays$ArrayList)[
      (Filters$SimpleEncodingFilter){
         fieldName=(String)"type",
         value=(String)"A"},
      (Filters$OperatorFilter){
         operatorName=(String)"$lt",
         fieldName=(String)"value",
         value=(Integer)1}]}
</pre>
<p>
driverのAPIでBsonを受け付けるものはDocumentを受け付けますので,仮にdriver-APIを直に呼び出す場合でも,無理せず<br>
&emsp;Document.parse("{$and[{type:'A'},{value:{lt:1}}]}")<br>
とすることをお勧めします。
</p>


<!--
ttps://api.mongodb.com/java/3.0/?org/bson/conversions/Bson.html
-->
<p><input type="button" value="説明を隠す△" style="WIDTH:10em"
   onClick="document.getElementById('divNode_2').style.display='none';
            document.getElementById('divNode_1').style.display='block';
            document.location='#divNode_1'"></p>
</div>


<p class=B1 id="build">
&emsp;ビルド
</p>
<div id="divBuild_1">
<p><input type="button" value="説明を表示する" style="WIDTH:10em"
   onClick="document.getElementById('divBuild_2').style.display='block';
            document.getElementById('divBuild_1').style.display='none'"></p>
</div>
<div id="divBuild_2" style="display:none">
<p><input type="button" value="説明を隠す" style="WIDTH:10em"
   onClick="document.getElementById('divBuild_2').style.display='none';
            document.getElementById('divBuild_1').style.display='block'"></p>
<p>
hiMongoを動かすには次のjarをリンクする必要があります。(バージョン番号は変わるかも知れません）
</p>
<table class=t0>
<tr>
<td>hiMongo_0_05.jar</td>
<td>:  hiMongo本体</td>
</tr>
<tr>
<td>hiNote_3_09.jar</td>
<td>:  hiJSON他汎用機能</td>
</tr>
<tr>
<td>mongo-java-driver-3.12.5.jar</td>
<td>:  mongo-java-driver</td>
</tr>
</table>
<p>
これらのjarが../libにあり、プログラムがTest.javaだとすると、次のようにビルド実行出来ます。
</p>
<pre class=prog10>
#!/bin/sh
# 注意！ 改行=LF
MAIN=Test
LIB_DIR=../lib
hiMongoLIB=hiMongo_0_05.jar
hiNoteLIB=hiNote_3_09.jar
mongoLIB=mongo-java-driver-3.12.5.jar
LIBS=".:${LIB_DIR}/${hiNoteLIB}:${LIB_DIR}/${mongoLIB}:${LIB_DIR}/${hiMongoLIB}
# ビルド
javac -Xlint:unchecked -encoding utf-8 -cp ${LIBS} ${MAIN}.java
# 実行
java -cp ${LIBS} ${MAIN}
</pre>
<p><input type="button" value="説明を隠す△" style="WIDTH:10em"
   onClick="document.getElementById('divBuild_2').style.display='none';
            document.getElementById('divBuild_1').style.display='block';
            document.location='#divBuild_1'"></p>
</div>




<p class=B1 id="log">
&emsp;ライブラリの出すログ
</p>
<div id="divLog_1">
<p><input type="button" value="説明を表示する" style="WIDTH:10em"
   onClick="document.getElementById('divLog_2').style.display='block';
            document.getElementById('divLog_1').style.display='none'"></p>
</div>
<div id="divLog_2" style="display:none">
<p><input type="button" value="説明を隠す" style="WIDTH:10em"
   onClick="document.getElementById('divLog_2').style.display='none';
            document.getElementById('divLog_1').style.display='block'"></p>
<p>
ライブラリが出すライブラリの為のログはライブラリの利用者にとって極めて邪魔なものです。
</p>
<p>
mongoDBはDBのopen/closeに関するログをコンソールに出します。
</p>
<p>
この停止法はまだ分かっていません。
</p>
<p><input type="button" value="説明を隠す△" style="WIDTH:10em"
   onClick="document.getElementById('divLog_2').style.display='none';
            document.getElementById('divLog_1').style.display='block';
            document.location='#divLog_1'"></p>
</div>
<p class=B2 id="interface"></p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>ネストされたクラスのサマリー</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="ネストされたクラスのサマリー表、ネストされたクラスのリストおよび説明">
<caption><span>ネストされたクラス</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">修飾子とタイプ</th>
<th class="colLast" scope="col">クラスと説明</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.Accessor.html" title="hi内のクラス">hiMongo.Accessor</a></span></code>
<div class="block">レコードアクセス機(Finder,Aggregatorのベース)</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.Aggregrator.html" title="hi内のクラス">hiMongo.Aggregrator</a></span></code>
<div class="block">集計器.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.Client.html" title="hi内のクラス">hiMongo.Client</a></span></code>
<div class="block">mongoDBサーバとの接続を表す.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.Collection.html" title="hi内のクラス">hiMongo.Collection</a></span></code>
<div class="block">collectionを表す.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.DB.html" title="hi内のクラス">hiMongo.DB</a></span></code>
<div class="block">database.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.Finder.html" title="hi内のクラス">hiMongo.Finder</a></span></code>
<div class="block">DB内レコード範囲設定、リスト取得機構.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.RemoteInfo.html" title="hi内のクラス">hiMongo.RemoteInfo</a></span></code>
<div class="block">接続先情報(connect引数).</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>メソッドのサマリー</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="メソッドのサマリー表、メソッドのリストおよび説明">
<caption><span id="t0" class="activeTableTab"><span>すべてのメソッド</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">staticメソッド</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">concreteメソッド</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">修飾子とタイプ</th>
<th class="colLast" scope="col">メソッドと説明</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static <a href="../hi/hiMongo.Client.html" title="hi内のクラス">hiMongo.Client</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#connect-java.lang.Object-">connect</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;remote_)</code>
<div class="block">サーバ接続を得る.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#date--">date</a></span>()</code>
<div class="block">現在時刻の拡張JSON表記を得る.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#engine--">engine</a></span>()</code>
<div class="block">JSON解析/表示エンジンのクローンを取得.
mongoDB用設定が追加されたJSON解析/表示エンジンを取得します。</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#json-java.lang.Object-">json</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</code>
<div class="block">標準JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合{"$oid":"..."}</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#json-java.lang.Object-long-">json</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_,
    long&nbsp;option_)</code>
<div class="block">標準JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合{"$oid":"..."}</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#mson-java.lang.Object-">mson</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</code>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#mson-java.lang.Object-long-">mson</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_,
    long&nbsp;option_)</code>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#nolog--">nolog</a></span>()</code>
<div class="block">Mongoのログを止める(未).</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#nolog-java.lang.Class-">nolog</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Class.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Class</a>&lt;?&gt;&nbsp;class_)</code>
<div class="block">mongoDBのログを止める（未）.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#parse-java.io.File-">parse</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html?is-external=true" title="java.io内のクラスまたはインタフェース">File</a>&nbsp;textFile_)</code>
<div class="block">パーズするFileを指定.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#parse-java.lang.String-">parse</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;text_)</code>
<div class="block">パーズするテキストを指定.</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#parseFile-java.lang.String-">parseFile</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;fileName_)</code>
<div class="block">パーズするテキストファイルを指定.</div>
</td>
</tr>
<tr id="i12" class="altColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#parseNode-java.lang.Object-">parseNode</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</code>
<div class="block">パーズするノードツリーObjectを指定.</div>
</td>
</tr>
<tr id="i13" class="rowColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#parseText-java.lang.String-">parseText</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;text_)</code>
<div class="block">パーズするテキストを指定.</div>
</td>
</tr>
<tr id="i14" class="altColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#str-java.lang.Object-">str</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</code>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
</td>
</tr>
<tr id="i15" class="rowColor">
<td class="colFirst"><code>static <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#str-java.lang.Object-long-">str</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_,
   long&nbsp;option_)</code>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
</td>
</tr>
<tr id="i16" class="altColor">
<td class="colFirst"><code>static <a href="../hi/hiMongo.DB.html" title="hi内のクラス">hiMongo.DB</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#use-java.lang.String-">use</a></span>(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;dbName_)</code>
<div class="block">デフォルト接続localhost.27017でデータベースを得る.</div>
</td>
</tr>
<tr id="i17" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../hi/hiMongo.html#with_hson-boolean-">with_hson</a></span>(boolean&nbsp;use_hson_)</code>
<div class="block">文字列解析にbson/msonでなくhiMongoのhsonを使う.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>クラスから継承されたメソッド&nbsp;java.lang.<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a></h3>
<code><a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="java.lang内のクラスまたはインタフェース">equals</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="java.lang内のクラスまたはインタフェース">getClass</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="java.lang内のクラスまたはインタフェース">hashCode</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="java.lang内のクラスまたはインタフェース">notify</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="java.lang内のクラスまたはインタフェース">notifyAll</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="java.lang内のクラスまたはインタフェース">toString</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="java.lang内のクラスまたはインタフェース">wait</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="java.lang内のクラスまたはインタフェース">wait</a>, <a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="java.lang内のクラスまたはインタフェース">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>メソッドの詳細</h3>
<a name="nolog--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>nolog</h4>
<pre>public static final&nbsp;void&nbsp;nolog()</pre>
<div class="block">Mongoのログを止める(未).
 残念ながらログを止めることはまだできていません。
 logbak.xml記述も効果はありませんでした。</div>
</li>
</ul>
<a name="nolog-java.lang.Class-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>nolog</h4>
<pre>public static&nbsp;void&nbsp;nolog(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Class.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Class</a>&lt;?&gt;&nbsp;class_)</pre>
<div class="block">mongoDBのログを止める（未）.</div>
</li>
</ul>
<a name="with_hson-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>with_hson</h4>
<pre>public static&nbsp;void&nbsp;with_hson(boolean&nbsp;use_hson_)</pre>
<div class="block">文字列解析にbson/msonでなくhiMongoのhsonを使う.
<p>
 拡張JSON文字列解析には標準ではorg.bson.Documentが用いられます。<br>
 操作に先立ちstaticメソッドであるhiMongo.with_hson(true)を指定すると以降はhiMongoの解析機構hsonが用いられます。<br>
 hsonではコメントが許されるほか[]で囲まない配列や18桁を超える10進数値をBigDecimalとして解釈することなどが出来ます。
</p>
<p>
このメソッドは全体に影響を与えます。
<a href="../hi/hiMongo.Collection.html#with_hson-boolean-"><code>db.get("xx").with_hson()...</code></a>
を用いれば、それぞれの場所での指定となります。
</p></div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>use_hson_</code> - true:hsonを用いる、false:hsonを用いない</dd>
</dl>
</li>
</ul>
<a name="parseText-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>parseText</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a>&nbsp;parseText(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;text_)</pre>
<div class="block">パーズするテキストを指定.
<p>
本メソッドの後ろにパーズ形式を指定することでパーズが実行されます。
</p>
<pre class=prog10>
  String  _json_text="....";
  MyClass _data= hiMongo.parseText(_json_text).asClass(MyClass.class);
</pre></div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>text_</code> - テキスト</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>解析エンジン</dd>
</dl>
</li>
</ul>
<a name="parse-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>parse</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a>&nbsp;parse(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;text_)</pre>
<div class="block">パーズするテキストを指定.</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>text_</code> - テキスト</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>解析エンジン</dd>
</dl>
</li>
</ul>
<a name="parse-java.io.File-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>parse</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a>&nbsp;parse(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/io/File.html?is-external=true" title="java.io内のクラスまたはインタフェース">File</a>&nbsp;textFile_)</pre>
<div class="block">パーズするFileを指定.</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>textFile_</code> - テキストファイル</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>解析エンジン</dd>
</dl>
</li>
</ul>
<a name="parseNode-java.lang.Object-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>parseNode</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a>&nbsp;parseNode(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</pre>
<div class="block">パーズするノードツリーObjectを指定.
<p>
本メソッドの後ろにパーズ形式を指定することでパーズが実行されます。<br>
他のツール(org.bson.Documentなど）で解析された結果のObjectもパーズできます。
</p>
<pre class=prog10>
  String   _json_text="....";
  Document _doc = Document.parse(_json_text);
  MyClass  _data= hiMongo.parseNode(_doc).asClass(MyClass.class);
</pre></div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>obj_</code> - ノードツリーObject</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>解析エンジン</dd>
</dl>
</li>
</ul>
<a name="parseFile-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>parseFile</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a>&nbsp;parseFile(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;fileName_)</pre>
<div class="block">パーズするテキストファイルを指定.
<p>
本メソッドの後ろにパーズ形式を指定することでパーズが実行されます。
</p>
<pre class=prog10>
  String  _json_file="./json.txt";
  MyClass _data= hiMongo.parseFile(_json_file).asClass(MyClass.class);
</pre></div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>fileName_</code> - テキストファイル名</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>解析エンジン</dd>
</dl>
</li>
</ul>
<a name="str-java.lang.Object-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>str</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;str(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</pre>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>obj_</code> - nodeオブジェクト</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>拡張JSON表記</dd>
</dl>
</li>
</ul>
<a name="str-java.lang.Object-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>str</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;str(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_,
                         long&nbsp;option_)</pre>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>obj_</code> - nodeオブジェクト</dd>
<dd><code>option_</code> - 表示オプション (hiU.WITH_INDENTなど)</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>拡張JSON表記</dd>
</dl>
</li>
</ul>
<a name="mson-java.lang.Object-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mson</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;mson(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</pre>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>obj_</code> - nodeオブジェクト</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>拡張JSON表記</dd>
</dl>
</li>
</ul>
<a name="mson-java.lang.Object-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mson</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;mson(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_,
                          long&nbsp;option_)</pre>
<div class="block">mongo拡張JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合ObjectId(),ISODate()の形で表示します。</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>obj_</code> - nodeオブジェクト</dd>
<dd><code>option_</code> - 表示オプション (hiU.WITH_INDENTなど)</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>拡張JSON表記</dd>
</dl>
</li>
</ul>
<a name="json-java.lang.Object-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>json</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;json(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_)</pre>
<div class="block">標準JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合{"$oid":"..."},{"$date":unixEpoch}で表示されます</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>obj_</code> - nodeオブジェクト</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>拡張JSON表記</dd>
</dl>
</li>
</ul>
<a name="json-java.lang.Object-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>json</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;json(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;obj_,
                          long&nbsp;option_)</pre>
<div class="block">標準JSON表記を得る.
nodeツリー上にObjectID,Dateクラスインスタンスが有る場合{"$oid":"..."},{"$date":unixEpoch}で表示されます</div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>obj_</code> - nodeオブジェクト</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>拡張JSON表記</dd>
</dl>
</li>
</ul>
<a name="engine--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>engine</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="http://www.otsu.co.jp/OtsuLibrary/jdoc/otsu/hiNote/hiJSON.Engine.html?is-external=true" title="otsu.hiNote内のクラスまたはインタフェース">hiJSON.Engine</a>&nbsp;engine()</pre>
<div class="block">JSON解析/表示エンジンのクローンを取得.
mongoDB用設定が追加されたJSON解析/表示エンジンを取得します。</div>
<dl>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>エンジン</dd>
</dl>
</li>
</ul>
<a name="date--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>date</h4>
<pre>public static&nbsp;<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;date()</pre>
<div class="block">現在時刻の拡張JSON表記を得る.
<p>
次の形式の文字列が得られます。
</p>
<pre class=prog10>
 {$date:<i>Unix-Epoch数値</i>}
 EX. {$date:1597648051506}
</pre></div>
<dl>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>拡張JSON表記</dd>
</dl>
</li>
</ul>
<a name="use-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>use</h4>
<pre>public static&nbsp;<a href="../hi/hiMongo.DB.html" title="hi内のクラス">hiMongo.DB</a>&nbsp;use(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/String.html?is-external=true" title="java.lang内のクラスまたはインタフェース">String</a>&nbsp;dbName_)</pre>
<div class="block">デフォルト接続localhost.27017でデータベースを得る.
<p>
DBクラスはCloseableなので閉じたプログラム空間で使用する場合は次のような記述が推奨されます。
</p>
<pre class=prog10>
try(hiMongo.DB db=hiMongo.use("db01")){
   // db手続き
   }
</pre></div>
<dl>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>データベース</dd>
</dl>
</li>
</ul>
<a name="connect-java.lang.Object-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>connect</h4>
<pre>public static&nbsp;<a href="../hi/hiMongo.Client.html" title="hi内のクラス">hiMongo.Client</a>&nbsp;connect(<a target="_blank" rel="noopener noreferrer" href="https://docs.oracle.com/javase/jp/8/docs/api/java/lang/Object.html?is-external=true" title="java.lang内のクラスまたはインタフェース">Object</a>&nbsp;remote_)</pre>
<div class="block">サーバ接続を得る.
<p>
ホスト名、ポート、ユーザ、ユーザ定義のあるdb、パスワードを指定し、mongoDBサーバに接続します。
</p>
<p>
引数はJSON文字列,<a href="../hi/hiMongo.RemoteInfo.html" title="hi内のクラス"><code>hiMongo.RemoteInfo</code></a>,JSONのnode解析結果のいずれかです。
</p>
<p>
JSON文字列で情報を与える.
</p>
<pre class=prog10>
DB db=hiMongo.connect("{"+
                      "host:'192.168.1.139',"+
                      "port:27017,"+
                      "dbName:'testDB',"+
                      "user:'testUser',"+
                      "password:'xxx'"+
                      "}")
              .use("db01");
db.get("coll_01").find()...
</pre>

<p>
<a href="../hi/hiMongo.RemoteInfo.html" title="hi内のクラス"><code>hiMongo.RemoteInfo</code></a>で情報を与える
</p>
<pre class=prog10>
hiMongo.RemoteInfo _info=new hiMongo.RemoteInfo();
_info.host    = "192.168.1.139";
_info.port    = 27017;
_info.dbName  = "testDB";
_info.user    = "testUser";
_info.password= "xxx";
DB db=hiMongo.connect(_info)
             .use("db01");
db.get("coll_01").find()...
</pre>

<p>
node解析結果で情報を与える
</p>
<pre class=prog10>
Object _node=<a href="../hi/hiMongo.html#parseText-java.lang.String-"><code>hiMongo.parseText</code></a>("{"+
                      "host:'192.168.1.139',"+
                      "port:27017,"+
                      "dbName:'testDB',"+
                      "user:'testUser',"+
                      "password:'xxx'"+
                      "}")
                     .asNode();
DB db=hiMongo.connect(_node)
             .use("db01");
db.get("coll_01").find()...
</pre></div>
<dl>
<dt><span class="paramLabel">パラメータ:</span></dt>
<dd><code>remote_</code> - JSONまたはnodeまたはhiMongo.RemoteInfo</dd>
<dt><span class="returnLabel">戻り値:</span></dt>
<dd>サーバとの接続</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="ナビゲーション・リンクをスキップ">ナビゲーション・リンクをスキップ</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="ナビゲーション">
<li><a href="../hi/package-summary.html">パッケージ</a></li>
<li class="navBarCell1Rev">クラス</li>
<li><a href="package-tree.html">階層ツリー</a></li>
<li><a href="../deprecated-list.html">非推奨</a></li>
<li><a href="../index-all.html">索引</a></li>
<li><a href="../help-doc.html">ヘルプ</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>前のクラス</li>
<li><a href="../hi/hiMongo.Accessor.html" title="hi内のクラス"><span class="typeNameLink">次のクラス</span></a></li>
</ul>
<ul class="navList">
<li><a href="../index.html?hi/hiMongo.html" target="_top">フレーム</a></li>
<li><a href="hiMongo.html" target="_top">フレームなし</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses-noframe.html">すべてのクラス</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>サマリー:&nbsp;</li>
<li><a href="#nested.class.summary">ネスト</a>&nbsp;|&nbsp;</li>
<li>フィールド&nbsp;|&nbsp;</li>
<li>コンストラクタ&nbsp;|&nbsp;</li>
<li><a href="#method.summary">メソッド</a></li>
</ul>
<ul class="subNavList">
<li>詳細:&nbsp;</li>
<li>フィールド&nbsp;|&nbsp;</li>
<li>コンストラクタ&nbsp;|&nbsp;</li>
<li><a href="#method.detail">メソッド</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>